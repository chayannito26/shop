## Quick orientation for AI coding agents

This is a small Vite + React + TypeScript storefront demo. The goal of this document is to give an AI coding agent the minimal, factual knowledge it needs to make productive, low-risk edits in this repository.

Key facts (big picture)
- App is a client-only SPA (Vite + React + TypeScript). Entry: `src/main.tsx` -> `src/App.tsx`.
- Routing uses `react-router-dom` with pages under `src/pages/*` (Home, ProductDetail, Cart, Checkout).
- Global state is handled with lightweight React Contexts in `src/contexts/` (Cart, Coupon, Modal). Persisted storage lives in `src/persistence/shopState.ts` and is intentionally decoupled from UI types.
- Product data is local and static under `src/data/products.ts` (catalog generated by `scripts/generate-catalog.ts`). The dev server runs `npm run dev` which executes `generate:catalog` then starts Vite.
- Pricing and variation logic is centralized in `src/utils/pricing.ts` (variation normalization, bulk rate helpers) — prefer using these helpers when adjusting prices, images, or variation behaviour.

Developer workflows (how to build / run / test)
- Start dev server: `npm run dev` (runs `npm run generate:catalog` then `vite`). The generate script uses `tsx scripts/generate-catalog.ts` and writes to `public/catalog/products.csv` and/or `src/data/products.ts` before starting.
- Build for production: `npm run build` (prebuild runs the same catalog generator).
- Preview a production build: `npm run preview`.
- Lint: `npm run lint` (uses eslint config at repo root).

Project-specific conventions & patterns
- Persistence API is minimal and defensive. Use `src/persistence/shopState.ts` helpers (Cart, Wishlist, RecentlyViewed, CheckoutForm) instead of directly reading localStorage. These helpers validate and cap sizes.
- CartContext maps persisted items into richer UI `CartItem` objects (see `src/contexts/CartContext.tsx`). When modifying cart behaviour, update both the persisted shape in `persistence/shopState.ts` and the consumer mapping logic in `CartContext`.
- Deterministic cart line identity: cart items use a stable key produced by `makeKey(productId, variation)` in `CartContext`. Avoid introducing other ad-hoc identifiers for line items.
- Variations: `variations` can be either strings or objects {label, price?, image?}. Use `src/utils/pricing.ts` helpers (`getVariationPrice`, `getProductImages`, `getNormalizedVariations`) to work with them.
- Images: Product image fields accept a string or string[] and the UI generally expects `getVariationImage(...)` to normalize to a single src for thumbnails.

Integration points & external deps
- Firebase is listed in dependencies (`firebase`), but there is no heavy server code here — check `src/firebase/config.ts` before changing anything that uses Firebase.
- Analytics Meta Pixel: SPA route tracking happens in `src/analytics/MetaPixelRouteListener.tsx`. Changes to routing or page transitions should consider this.
- Catalog generator: `scripts/generate-catalog.ts` produces or updates `src/data/products.ts` and/or `public/catalog/products.csv`. When editing product shapes, ensure the generator and `products.ts` remain consistent.

Safe-edit checklist (short, concrete)
- When changing types exported from `src/utils/pricing.ts`, update usages in `src/contexts/CartContext.tsx` and `src/data/products.ts`.
- When changing persistence shapes (CartItem, CartState), update `src/persistence/shopState.ts` validate/mapper functions and `CartContext` mapping.
- When adding new UI routes, update `src/App.tsx` Routes and ensure `MetaPixelRouteListener` still covers navigation.
- When modifying product images/variations, use `getProductImages`/`getVariationImage` to keep UI consistent.

Examples to reference in edits
- Cart mapping from persisted store -> UI cart: `src/contexts/CartContext.tsx` (function mapPersistedToCartState).
- Variation helpers: `src/utils/pricing.ts` (normalization + bulk rate logic).
- Persisted API: `src/persistence/shopState.ts` (Cart.replaceItems, Cart.addItem, CheckoutForm helpers).
- Dev start hook that generates catalog: `package.json` script `generate:catalog` -> `scripts/generate-catalog.ts`.

What not to change without CI or author confirmation
- Storage keys and validation logic in `src/persistence/shopState.ts` (caps and redaction). These affect cross-tab and long-term data integrity.
- Deterministic cart keying and direct-order flow in `CartContext` — subtle UX depends on these behaviors.

If you need more info or permission to make larger changes, ask for the owner's intent on:
- Intended durable product shape (should products be treated as authoritative source-of-truth or derived from CSV?)
- Any active Firebase integrations or API keys that should not be modified.
